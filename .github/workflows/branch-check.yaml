# name: Prevent Branch Creation from "release" and "source_code_god"
# on:
#   create:
#     branches:
#       - '*'
# jobs:
#   check-source:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v4
#         with:
#           fetch-depth: 0  # すべての履歴を取得

#       - name: Check if branch was created from restricted branches
#         run: |
#           NEW_BRANCH="${GITHUB_REF#refs/heads/}"

#           # ブロック対象のブランチリスト
#           BLOCKED_BRANCHES=("release" "source_code_god")

#           # 各ブロック対象のブランチと、新規ブランチの共通の祖先を取得
#           for BLOCKED in "${BLOCKED_BRANCHES[@]}"; do
#             COMMON_ANCESTOR=$(git merge-base $NEW_BRANCH origin/$BLOCKED || echo "")

#             # 共通の祖先がブロック対象ブランチの最新コミットと一致するか確認
#             BLOCKED_COMMIT=$(git rev-parse origin/$BLOCKED 2>/dev/null || echo "")

#             if [ "$COMMON_ANCESTOR" == "$BLOCKED_COMMIT" ]; then
#               echo "❌ New branches cannot be created from '$BLOCKED'."
#               exit 1
#             fi
#           done

#           echo "✅ This branch creation is allowed."




name: Restrict Branch Creation

on:
  create:
    branches:
      - '**'  # すべてのブランチ作成を監視

jobs:
  check-branch-creation:
    runs-on: ubuntu-latest
    steps:
      - name: Check if branch is created from restricted branches
        run: |
          BASE_BRANCH=$(curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/${{ github.repository }}/git/refs/heads/${{ github.ref_name }}" \
            | jq -r '.object.sha')

          if [ "${{ github.ref }}" == "refs/heads/release" ] || [ "${{ github.ref }}" == "refs/heads/source_code_god" ]; then
            echo "❌ 新しいブランチを 'release' または 'source_code_god' から作成することは禁止されています。"
            exit 1
          fi




# name: ブランチ作成制限

# on:
#   create:
#     branches:
#       - '**' # すべてのブランチ作成イベントをトリガー

# jobs:
#   check-branch-creation:
#     runs-on: ubuntu-latest
#     steps:
#       - name: ブランチ名を取得
#         id: get-branch-name
#         run: echo "::set-output name=branch_name::$(echo $GITHUB_REF | cut -d '/' -f 3)"

#       - name: 禁止ブランチからの作成をチェック
#         if: contains(fromJson('["release", "source_code_god"]'), steps.get-branch-name.outputs.branch_name)
#         uses: actions/github-script@v6
#         with:
#           script: |
#             core.setFailed('このブランチからの新しいブランチ作成は禁止されています。');

#       - name: developブランチからの作成を許可
#         if: steps.get-branch-name.outputs.branch_name == 'develop'
#         uses: actions/github-script@v6
#         with:
#           script: |
#             console.log('developブランチからの作成は許可されています。');
