name: ブランチ作成制限

on:
  create:
    branches:
      - '**' # すべてのブランチ作成イベントをトリガー

jobs:
  check-branch-creation:
    runs-on: ubuntu-latest
    steps:
      - name: ブランチ名を取得
        id: get-branch-name
        run: echo "::set-output name=branch_name::$(echo $GITHUB_REF | cut -d '/' -f 3)"

      - name: 禁止ブランチからの作成をチェック
        if: contains(fromJson('["release", "source_code_god"]'), steps.get-branch-name.outputs.branch_name)
        uses: actions/github-script@v6
        with:
          script: |
            core.setFailed('このブランチからの新しいブランチ作成は禁止されています。');

      - name: developブランチからの作成を許可
        if: steps.get-branch-name.outputs.branch_name == 'develop'
        uses: actions/github-script@v6
        with:
          script: |
            console.log('developブランチからの作成は許可されています。');
